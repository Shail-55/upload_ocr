<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaddleOCR - Advanced OCR</title>
    <style>
        /* --- Your existing CSS --- */
        * {margin:0;padding:0;box-sizing:border-box;}
        body {font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f5f7fa;padding:20px;}
        .header{text-align:center;margin-bottom:30px;}
        .header h1{color:#2c3e50;font-size:32px;margin-bottom:10px;}
        .container{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:1fr 1fr;gap:20px;}
        @media(max-width:768px){.container{grid-template-columns:1fr;}}
        .panel{background:white;border-radius:12px;padding:25px;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
        .panel-title{font-size:18px;font-weight:600;color:#2c3e50;margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid #3498db;}
        .upload-zone{border:3px dashed #bdc3c7;border-radius:8px;padding:40px;text-align:center;cursor:pointer;transition:all 0.3s;background:#f8f9fa;}
        .upload-zone:hover{border-color:#3498db;background:#e3f2fd;}
        .upload-zone.dragover{border-color:#2980b9;background:#bbdefb;}
        input[type="file"]{display:none;}
        .preview-container{margin-top:20px;text-align:center;}
        .preview-image{max-width:100%;max-height:400px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.1);display:none;}
        .preview-image.show{display:block;}
        .btn{background:#3498db;color:white;border:none;padding:12px 24px;border-radius:6px;font-size:16px;font-weight:600;cursor:pointer;width:100%;margin-top:15px;transition:background 0.3s;}
        .btn:hover{background:#2980b9;}
        .btn:disabled{background:#95a5a6;cursor:not-allowed;}
        .btn-secondary{background:#95a5a6;}
        .btn-secondary:hover{background:#7f8c8d;}
        .progress-bar{width:100%;height:6px;background:#ecf0f1;border-radius:3px;overflow:hidden;margin-top:15px;display:none;}
        .progress-bar.show{display:block;}
        .progress-fill{height:100%;background:linear-gradient(90deg,#3498db,#2ecc71);width:0%;transition:width 0.3s;animation:progress 1.5s ease-in-out infinite;}
        @keyframes progress{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}
        .result-text{background:#f8f9fa;border:1px solid #dee2e6;border-radius:6px;padding:15px;min-height:200px;max-height:500px;overflow-y:auto;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New',monospace;font-size:14px;line-height:1.6;color:#2c3e50;}
        .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:15px;}
        .stat-box{background:#f8f9fa;padding:12px;border-radius:6px;text-align:center;}
        .stat-label{font-size:12px;color:#7f8c8d;margin-bottom:5px;}
        .stat-value{font-size:18px;font-weight:600;color:#2c3e50;}
        .alert{padding:12px;border-radius:6px;margin-top:15px;display:none;}
        .alert.show{display:block;}
        .alert-error{background:#fee;color:#c33;border:1px solid #fcc;}
        .alert-success{background:#efe;color:#3c3;border:1px solid #cfc;}
        .copy-btn{background:#27ae60;padding:8px 16px;font-size:14px;margin-top:10px;}
        .copy-btn:hover{background:#229954;}
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç PaddleOCR Text Extraction</h1>
        <p style="color:#7f8c8d;">Extract text from images and PDFs with AI</p>
    </div>
    <div class="container">
        <!-- Left Panel -->
        <div class="panel">
            <div class="panel-title">üì§ Upload File</div>
            <div class="upload-zone" id="uploadZone">
                <div style="font-size:48px;margin-bottom:15px;">üìÑ</div>
                <div style="font-size:16px;font-weight:600;color:#3498db;margin-bottom:8px;">Click to upload or drag and drop</div>
                <div style="font-size:14px;color:#95a5a6;">JPG, PNG, PDF ‚Ä¢ Max 10MB</div>
                <input type="file" id="fileInput" accept="image/*,.pdf">
            </div>
            <div class="preview-container">
                <img id="preview" class="preview-image" alt="Preview">
            </div>
            <div id="fileDetails" style="margin-top:15px;display:none;">
                <div style="font-size:14px;color:#7f8c8d;">
                    <strong>File:</strong> <span id="fileNameDisplay"></span><br>
                    <strong>Size:</strong> <span id="fileSizeDisplay"></span><br>
                    <strong>Type:</strong> <span id="fileTypeDisplay"></span>
                </div>
            </div>
            <button class="btn" id="extractBtn" disabled>üöÄ Extract Text</button>
            <button class="btn btn-secondary" id="clearBtn" style="display:none;">üîÑ Clear</button>
            <div class="progress-bar" id="progressBar"><div class="progress-fill"></div></div>
            <div class="alert alert-error" id="errorAlert"></div>
            <div class="alert alert-success" id="successAlert"></div>
        </div>
        <!-- Right Panel -->
        <div class="panel">
            <div class="panel-title">üìã Extracted Text</div>
            <div class="result-text" id="resultText">Your extracted text will appear here...</div>
            <button class="btn copy-btn" id="copyBtn" style="display:none;">üìã Copy to Clipboard</button>
            <div class="stats" id="stats" style="display:none;">
                <div class="stat-box"><div class="stat-label">Characters</div><div class="stat-value" id="charCount">0</div></div>
                <div class="stat-box"><div class="stat-label">Words</div><div class="stat-value" id="wordCount">0</div></div>
                <div class="stat-box"><div class="stat-label">Lines</div><div class="stat-value" id="lineCount">0</div></div>
            </div>
        </div>
    </div>

    <script>
        const WEBHOOK_URL = 'http://localhost:5678/webhook-test/ocr-upload';
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        const preview = document.getElementById('preview');
        const extractBtn = document.getElementById('extractBtn');
        const clearBtn = document.getElementById('clearBtn');
        const resultText = document.getElementById('resultText');
        const copyBtn = document.getElementById('copyBtn');
        const progressBar = document.getElementById('progressBar');
        const errorAlert = document.getElementById('errorAlert');
        const successAlert = document.getElementById('successAlert');
        const fileDetails = document.getElementById('fileDetails');
        const stats = document.getElementById('stats');

        let selectedFile = null;

        uploadZone.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => handleFileSelect(e.target.files[0]));
        extractBtn.addEventListener('click', extractText);
        clearBtn.addEventListener('click', clearAll);
        copyBtn.addEventListener('click', copyToClipboard);
        uploadZone.addEventListener('dragover', (e)=>{e.preventDefault();uploadZone.classList.add('dragover');});
        uploadZone.addEventListener('dragleave', ()=>{uploadZone.classList.remove('dragover');});
        uploadZone.addEventListener('drop', (e)=>{e.preventDefault();uploadZone.classList.remove('dragover');handleFileSelect(e.dataTransfer.files[0]);});

        function handleFileSelect(file){
            if(!file) return;
            const validTypes=['image/jpeg','image/jpg','image/png','image/gif','image/bmp','application/pdf'];
            const maxSize=10*1024*1024;
            if(!validTypes.includes(file.type)){showError('Invalid file type. Please upload an image or PDF.'); return;}
            if(file.size>maxSize){showError('File too large. Maximum size is 10MB.'); return;}
            selectedFile=file;
            if(file.type.startsWith('image/')){
                const reader=new FileReader();
                reader.onload=(e)=>{preview.src=e.target.result;preview.classList.add('show');};
                reader.readAsDataURL(file);
            }else{preview.classList.remove('show');}
            document.getElementById('fileNameDisplay').textContent=file.name;
            document.getElementById('fileSizeDisplay').textContent=formatFileSize(file.size);
            document.getElementById('fileTypeDisplay').textContent=file.type;
            fileDetails.style.display='block';
            extractBtn.disabled=false;
            clearBtn.style.display='block';
            hideAlerts();
        }

        async function extractText(){
            if(!selectedFile) return;
            extractBtn.disabled=true;
            progressBar.classList.add('show');
            hideAlerts();
            const formData=new FormData();
            formData.append('file',selectedFile);
            try{
                const response=await fetch(WEBHOOK_URL,{method:'POST',body:formData});
                if(!response.ok) throw new Error(`Server error: ${response.status}`);
                
                let data;
                try {data = await response.json();} 
                catch(e) {throw new Error('Invalid JSON response from server');}

                const text=data.full_text||'No text found.';
                resultText.textContent=text;
                copyBtn.style.display='block';
                stats.style.display='grid';
                document.getElementById('charCount').textContent=text.length;
                document.getElementById('wordCount').textContent=text.split(/\s+/).filter(w=>w).length;
                document.getElementById('lineCount').textContent=text.split('\n').length;
                if(data.success) showSuccess('Text extracted successfully!');
                else showError('Failed to extract text.');
            }catch(err){showError(`Error: ${err.message}`);}
            finally{progressBar.classList.remove('show');extractBtn.disabled=false;}
        }

        function clearAll(){
            selectedFile=null;
            fileInput.value='';
            preview.classList.remove('show');
            fileDetails.style.display='none';
            extractBtn.disabled=true;
            clearBtn.style.display='none';
            resultText.textContent='Your extracted text will appear here...';
            copyBtn.style.display='none';
            stats.style.display='none';
            hideAlerts();
        }

        async function copyToClipboard(){
            try{await navigator.clipboard.writeText(resultText.textContent);showSuccess('Copied to clipboard!');}
            catch(err){showError('Failed to copy to clipboard');}
        }

        function showError(message){errorAlert.textContent=message;errorAlert.classList.add('show');successAlert.classList.remove('show');}
        function showSuccess(message){successAlert.textContent=message;successAlert.classList.add('show');errorAlert.classList.remove('show');}
        function hideAlerts(){errorAlert.classList.remove('show');successAlert.classList.remove('show');}
        function formatFileSize(bytes){if(bytes===0)return'0 Bytes';const k=1024;const sizes=['Bytes','KB','MB'];const i=Math.floor(Math.log(bytes)/Math.log(k));return Math.round(bytes/Math.pow(k,i)*100)/100+' '+sizes[i];}
    </script>
</body>
</html>
